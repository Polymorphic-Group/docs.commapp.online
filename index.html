<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-10-17 Thu 08:08 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>CommStack Backend Documentation Constellation Tables Refinery</title>
<meta name="generator" content="Org mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/search.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<link rel="stylesheet" type="text/css" href="src/readtheorg_theme/css/search.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/search.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">CommStack Backend Documentation Constellation Tables Refinery</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga80bccb">Constellation</a>
<ul>
<li><a href="#orge5ed9af">Form Field Configuration</a>
<ul>
<li><a href="#orge33f251">Required fields</a></li>
<li><a href="#constellation-formFiekds-automatic">Automatic field values</a></li>
<li><a href="#orgbd273e9">Optional form sections</a></li>
<li><a href="#form-field-group-names">Group names</a></li>
</ul>
</li>
<li><a href="#constellation-actionButtons">Action Buttons</a></li>
<li><a href="#key-fields">Key Fields</a>
<ul>
<li><a href="#org77ef593">Maps</a></li>
<li><a href="#org61af321">Calendar</a></li>
</ul>
</li>
<li><a href="#orgd695385">Custom User Dashboards</a>
<ul>
<li><a href="#dashboard-permission-link">Dashboard to Permission link</a></li>
</ul>
</li>
<li><a href="#orga65d7c8">Invoice Forms</a>
<ul>
<li><a href="#org10da127">Basic FLL Setup</a></li>
</ul>
</li>
<li><a href="#orgd75e8b1">Tables</a>
<ul>
<li><a href="#tables-dynamic-filters">Dynamic Filters</a></li>
<li><a href="#tables-special-columns">Special Columns</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge62f473">Refinery</a>
<ul>
<li><a href="#orgc9bee56">Refinery Events</a>
<ul>
<li><a href="#orge094203">Buying Process</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orga80bccb" class="outline-2">
<h2 id="orga80bccb">Constellation</h2>
<div class="outline-text-2" id="text-orga80bccb">
</div>

<div id="outline-container-orge5ed9af" class="outline-3">
<h3 id="orge5ed9af">Form Field Configuration</h3>
<div class="outline-text-3" id="text-orge5ed9af">
</div>
<div id="outline-container-orge33f251" class="outline-4">
<h4 id="orge33f251">Required fields</h4>
<div class="outline-text-4" id="text-orge33f251">
<p>
On the FormAdd, include a <code>*</code> in front of each required field.
</p>

<div class="org-src-container">
<pre class="src src-text">*Title Description
</pre>
</div>
<p>
In the example above, Title will be required.
</p>
</div>
</div>


<div id="outline-container-org105a84f" class="outline-4">
<h4 id="constellation-formFiekds-automatic">Automatic field values</h4>
<div class="outline-text-4" id="text-constellation-formFiekds-automatic">
<p>
A form field can be configured to automatically be filled in, either from a property of the user, or by the current date (using the keyword <i>Now</i>).
</p>

<p>
An example of automated values is bellow:
</p>
<div class="org-src-container">
<pre class="src src-text">Title Branch{Branch} CapturedBy{Title} CaturedOn{Now}
</pre>
</div>

<p>
Please note, the value "Title" in the example.
This is because the user name is in the "Title" field, and to have function lookups working, it will need to attach to the "Title" field of the user.
</p>
</div>
</div>


<div id="outline-container-orgbd273e9" class="outline-4">
<h4 id="orgbd273e9">Optional form sections</h4>
<div class="outline-text-4" id="text-orgbd273e9">
<p>
On a multi section form, sections can be hidden if the field deffinition starts with a filter value.<br />
A filter value will be in the format <code>{"FieldName":"Condition"}</code> and be the first item on the row.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 1: </span>Optional section example</label><pre class="src src-text" id="orgf93174a">*Name Address *Province *Branch *PaymentCode AuthorizedSignatoryName
{"Branch":"HRE"} NationalIdNo PhoneNumber ComplianceStatus
EmailAddress ComplianceStatus CustomerStatus  LicenceType
{"Branch":"HRE","ComplianceStatus":"Current"} LicenceNo LicenceExpDate VatNo NameOfBank
AccountNumber BranchCode ComplianceStatus CustomerType
</pre>
</div>

<p>
In listing <a href="#orgf93174a">1</a> The second section will only be shown if <i>Branch</i> is set to "HRE".
The fifth section will only be shown if  <i>Branch</i> is "HRE" and if <i>ComplianceStatus</i> is Current.
</p>
</div>
</div>


<div id="outline-container-org3a547ad" class="outline-4">
<h4 id="form-field-group-names">Group names</h4>
<div class="outline-text-4" id="text-form-field-group-names">
<p>
Group names can be added to <i>View</i> fields. <br />
Optionally, they can also be added to <i>Edit</i> and <i>Add</i> fields.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 2: </span>e.g. Form View</label><pre class="src src-text">"Section 1" Name Address Province Branch NameOfBank ComplianceStatus NationalIdNo PhoneNumber 
"Section 2" LicenceNo LicenceExpDate VatNo LicenceType AccountNumber BranchCode
"Section 3" SwiftCode ComplianceStatus CustomerType PaymentCode EmailAddress
</pre>
</div>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 3: </span>e.g. Form Add</label><pre class="src src-text">"A1" *Name Address *Province *Branch *PaymentCode AuthorizedSignatoryName 
"A2" {"Branch":"HRE"} NationalIdNo PhoneNumber ComplianceStatus 
"B1" EmailAddress ComplianceStatus CustomerStatus  LicenceType 
"B2" {"Branch":"HRE","ComplianceStatus":"Current"} LicenceNo LicenceExpDate VatNo NameOfBank 
"C" AccountNumber BranchCode ComplianceStatus CustomerType
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org2791b60" class="outline-3">
<h3 id="constellation-actionButtons">Action Buttons</h3>
<div class="outline-text-3" id="text-constellation-actionButtons">
<p>
Actions buttons are created in the <i>Custom Button</i> field, with the format <code>ButtonName|Field1|Value1|Field2|Value2</code>.
</p>

<p>
Like form fields, some automatic values can be set.
Either from the user properties, or the current date.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 4: </span>Example action button</label><pre class="src src-text">Approve|ProcessStatus|Approved|ApprovedBy|{Title}|ApprovedOn|{Now}
</pre>
</div>
</div>
</div>


<div id="outline-container-org363d7dd" class="outline-3">
<h3 id="key-fields">Key Fields</h3>
<div class="outline-text-3" id="text-key-fields">
<p>
To configure a key field, confirm the required field is configured in the permission <code>Columns</code>.
</p>
</div>

<div id="outline-container-org77ef593" class="outline-4">
<h4 id="org77ef593">Maps</h4>
<div class="outline-text-4" id="text-org77ef593">
<p>
If the Key Field is of the type GeoLocation, the table will be displayed as a map.
</p>
</div>
</div>

<div id="outline-container-org61af321" class="outline-4">
<h4 id="org61af321">Calendar</h4>
<div class="outline-text-4" id="text-org61af321">
<p>
If the Key Field type is Date or Date and Time, the data will be shown in Constellation as a table.
If the Secondary Field is also set, this will be used as an "End Date".
</p>
</div>
</div>
</div>


<div id="outline-container-orgd695385" class="outline-3">
<h3 id="orgd695385">Custom User Dashboards</h3>
<div class="outline-text-3" id="text-orgd695385">
<p>
A Custom User dashboard can be created by setting the <code>Dashboard</code> field on the User instance in Musketeer.
</p>

<p>
An example <code>Dashboard</code> is bellow.
</p>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 5: </span><i>Dashboard</i> example.</label><pre class="src src-json">[
    {
      "chart": {
	"fllChartId": 2922,
	"title": "Customer status",
	"dateField": "Date"
      },
      "colSpan": 4,
      "rowSpan": 1
    },
    {
      "chart": {
	"fllChartId": 2940,
	"title": "Payment",
	"dateField": "Date"
      },
      "rowSpan": 1,
      "colSpan": 1
    },
    {
      "chart": {
	"fllChartId": 2800,
	"title": "Weight by PC",
	"dateField": "DateOfReceipt"
      },
      "rowSpan": 1,
      "colSpan": 1
    },
    {
      "chart": {
	"fllChartId": 2801,
	"title": "Payment Code Count",
	"dateField": "DateOfReceipt"
      },
      "rowSpan": 1,
      "colSpan": 1
    },
    {
      "chart": {
	"fllChartId": 2887,
	"title": "Quote Value"
      },
      "rowSpan": 1,
      "colSpan": 1
    }
]
</pre>
</div>
</div>

<div id="outline-container-orgbe3ad73" class="outline-4">
<h4 id="dashboard-permission-link">Dashboard to Permission link</h4>
<div class="outline-text-4" id="text-dashboard-permission-link">
<p>
A dashboard can be given a link to a permission.
</p>

<p>
This is done by adding a "permission" property to user's <i>Dashboard</i>, as in the example below.
</p>

<div class="org-src-container">
<pre class="src src-json">[
    {
      "chart": {
	"fllChartId": 2922,
	"title": "Customer status",
	"dateField": "Date"
      },
      "permission": "test-permission",
      "colSpan": 4,
      "rowSpan": 1
    }
]
</pre>
</div>
</div>
</div>
</div>



<div id="outline-container-orga65d7c8" class="outline-3">
<h3 id="orga65d7c8">Invoice Forms</h3>
<div class="outline-text-3" id="text-orga65d7c8">
<p>
Invoice forms allow table rows to be added inlinde while capturing data.
</p>

<p>
These instructions assume knowlage on configuring a standard permssions.
</p>
</div>

<div id="outline-container-org10da127" class="outline-4">
<h4 id="org10da127">Basic FLL Setup</h4>
<div class="outline-text-4" id="text-org10da127">
</div>
<ul class="org-ul">
<li><a id="org4737761"></a>Musketeer Configuration<br />
<div class="outline-text-5" id="text-org4737761">
<p>
Three tables are required in Muskteer.
</p>


<div class="figure">
<p><img src="constellation/invoice-basic-setup-fll.png" alt="invoice-basic-setup-fll.png" />
</p>
</div>

<dl class="org-dl">
<dt>Item source table (1)</dt><dd>It is advised that this is a library table.
This holds the deffinitions of items that will be selected on the form.
If the form is for invoices this will hold a list of possible broducs that are being invoiced for.</dd>

<dt>Main table (2)</dt><dd>This is the main table that is used to hold invoices, receiepts, purchase orders, etc.</dd>

<dt>Item table (3)</dt><dd>It is advised that this inherits from the source table, so long that the source table is a library.
This table holds line items of the main record.
These are imported from the source table.</dd>
</dl>
</div>

<ul class="org-ul">
<li><a id="orgdb6bafa"></a>Permssion Configuration<br />
<div class="outline-text-6" id="text-orgdb6bafa">
<p>
Two permissions are required to be created.
</p>
</div>

<ul class="org-ul">
<li><a id="org249145a"></a>The Item permission<br />
<div class="outline-text-7" id="text-org249145a">
<p>
Needs to reference the item table (3).
</p>
</div>
</li>

<li><a id="orga05c2c0"></a>The Main permssion<br />
<div class="outline-text-7" id="text-orga05c2c0">
<p>
Needs to reference the main table (2).
</p>

<p>
To add the input table into the form, two things need to be done:
</p>

<ol class="org-ol">
<li>The item permission needs to be added as level 2.</li>

<li>A special line<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> needs to be added to the <i>Form Add</i> field.
This needs to be in the format ,without spaces, item permission, colon, and the FLL ID of the Item Source table (1), <code>item-permission:source-fll</code>.</li>
</ol>

<div class="org-src-container">
<label class="org-src-name"><span class="listing-number">Listing 6: </span><i>Form Add</i> example.</label><pre class="src src-txt">Title
Description Date Address
invoice-line-items:1234
</pre>
</div>
</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>


<div id="outline-container-orgd75e8b1" class="outline-3">
<h3 id="orgd75e8b1">Tables</h3>
<div class="outline-text-3" id="text-orgd75e8b1">
<p>
:CUSTOM<sub>ID</sub>: tables
</p>
</div>

<div id="outline-container-org721e31a" class="outline-4">
<h4 id="tables-dynamic-filters">Dynamic Filters</h4>
<div class="outline-text-4" id="text-tables-dynamic-filters">
<p>
Dynamic filters can be created, allowing Constellation tables to be filtered based on User properties.
</p>

<p>
On the permission, the <i>Process Status Filter</i> is configured as normal, except the value to be replaced by a user field is wrapped in braces. <br />
e.g. <br />
</p>
<div class="org-src-container">
<pre class="src src-txt">Branch:{Branch},PaymentCode:SG
</pre>
</div>

<p>
In the above example, is a user has a <i>Branch</i> field (e.g. HRE) then <code>{Branch}</code> will be substituted when data for the table is requested.
</p>
</div>
</div>

<div id="outline-container-orgc1402b8" class="outline-4">
<h4 id="tables-special-columns">Special Columns</h4>
<div class="outline-text-4" id="text-tables-special-columns">
<p>
The tables allow special columns, ususlly starting with a <i>bang</i> <code>!</code> in the definition.
</p>
</div>

<ul class="org-ul">
<li><a id="tables-special-columns-age"></a>Age<br />
<div class="outline-text-5" id="text-tables-special-columns-age">
<p>
Age will provide a count of days since a particular date.
</p>

<p>
The <b>Age</b> column is defined as <code>!AGE</code>. <br />
The preceding column has to be a <i>Date</i> or a <i>Data and Time</i> column.
</p>
</div>
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orge62f473" class="outline-2">
<h2 id="orge62f473">Refinery</h2>
<div class="outline-text-2" id="text-orge62f473">
</div>

<div id="outline-container-orgc9bee56" class="outline-3">
<h3 id="orgc9bee56">Refinery Events</h3>
<div class="outline-text-3" id="text-orgc9bee56">
</div>
<div id="outline-container-orge094203" class="outline-4">
<h4 id="orge094203">Buying Process</h4>
<div class="outline-text-4" id="text-orge094203">
</div>
<ul class="org-ul">
<li><a id="orgce5be9d"></a>Bullion Received<br />
<div class="outline-text-5" id="text-orgce5be9d">
<div class="org-src-container">
<pre class="src src-json">{
  "bullionId": "HRE-SG-24050004",
  "customer": "HRE-AAA-001",
  "mine": "DID-1658954",
  "paymentCode": "SG",
  "items": [
    {
      "weight": {
	"kilograms": 12.0
      },
      "descriptors": [
	"Cu"
      ],
      "type": "ingot"
    }
  ],
  "time": "2024-05-14T13:53:54.6792758+03:00",
  "user": "JonathanPeel",
  "event": "BullionReceived"
}
</pre>
</div>
</div>
</li>

<li><a id="org1b64f8d"></a>Specific Gravity Signoff<br />
<div class="outline-text-5" id="text-org1b64f8d">
<div class="org-src-container">
<pre class="src src-json">{
  "bullionId": "HRE-SG-24050004",
  "fineness": 876.0,
  "time": "2024-05-14T15:26:15.167155+03:00",
  "user": "JonathanPeel",
  "event": "SpecificGravitySignedOff"
}
</pre>
</div>
</div>
</li>

<li><a id="org61063bf"></a>Price Approved (SG)<br />
<div class="outline-text-5" id="text-org61063bf">
<dl class="org-dl">
<dt>routing key</dt><dd><code>commstack.refinery.PriceApprovedEvent</code></dd>
</dl>

<div class="org-src-container">
<pre class="src src-json">{
  "bullionId": "HRE-SG-24050004",
  "time": "2024-05-14T15:26:15.167155+03:00",
  "user": "JonathanPeel",
  "event": "PriceApproved",
  "goldPayable": { "kilograms": 11.0 },
  "royaltyCharges": { "usd": 123.0 },
  "refineryCharges": { "usd": 123.0 },
  "otherCharges": { "usd": 123.0 },
  "net": { "usd": 123.0 },
}
</pre>
</div>
</div>
</li>

<li><a id="orga9f8c8a"></a>Weight After Melton<br />
<div class="outline-text-5" id="text-orga9f8c8a">
<dl class="org-dl">
<dt>routing key</dt><dd><code>commstack.refinery.WeightAfterMeltCompleted</code></dd>
</dl>

<div class="org-src-container">
<pre class="src src-json">{
  "event": "WeightAfterMeltCompleted",
  "user": "JonathanPeel",
  "time": "2024-05-16T12:27:10.0397771+00:00",
  "bullionId": "HRE-BBF-24050001",
  "IngotWeigh": {
    "kilograms": 1.0
  },
  "SampleWeight": {
    "kilograms": 12.0
  },
  "totalWeight": {
    "kilograms": 13.0
  }
}
</pre>
</div>
</div>
</li>

<li><a id="org2bbfaf5"></a>Fire Assay Batch Sign Offenbach<br />
<div class="outline-text-5" id="text-org2bbfaf5">
<dl class="org-dl">
<dt>routing key</dt><dd>commstack.refinery.FireAssayBatchSignOff</dd>
</dl>

<div class="org-src-container">
<pre class="src src-json">{
  "batchId": "240520-2",
  "bullion": [
    {
      "bullionId": "HRE-BBF-24050001",
      "fineness": 996.4875
    }
  ],
  "time": "2024-05-20T05:43:19.5480169+03:00",
  "user": "JonathanPeel",
  "event": "FireAssayBatchSignOff"
}
</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">On an invoice form, field rows will be broken into rows. The item table field should be on it's own row.</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Created: 2024-10-17 Thu 08:08</p>
</div>
</body>
</html>
